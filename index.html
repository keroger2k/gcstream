<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JWT Refresh Token UI</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Get Access Token</h1>
        <p>Click the button below to retrieve or refresh your access token from the server.</p>
        <button id="getTokenButton">Get Token</button>
        <div id="loader" class="loader" style="display: none;"></div>
        <h2>Token Information:</h2>
        <div id="tokenInfo" class="result-box">
            <p>Token details will appear here.</p>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const getTokenButton = document.getElementById('getTokenButton');
            const tokenInfoDiv = document.getElementById('tokenInfo');
            const loader = document.getElementById('loader');
            const serverUrl = 'http://localhost:3000'; // Assuming server.js runs on port 3000

            getTokenButton.addEventListener('click', async () => {
                loader.style.display = 'block';
                tokenInfoDiv.innerHTML = '<p>Fetching token...</p>';

                try {
                    const response = await fetch(`${serverUrl}/refresh_token`);
                    const data = await response.json();

                    loader.style.display = 'none';

                    if (response.ok) {
                        const expiryDate = new Date(data.expires * 1000);
                        tokenInfoDiv.innerHTML = `
                            <p><strong>Status:</strong> ${data.status}</p>
                            <p><strong>Access Token:</strong></p>
                            <textarea readonly>${data.token}</textarea>
                            <p><strong>Expires:</strong> ${expiryDate.toLocaleString()}</p>
                        `;
                    } else {
                        tokenInfoDiv.innerHTML = `
                            <p><strong>Error:</strong> ${data.error || response.statusText}</p>
                            <p><strong>Details:</strong> ${data.details || 'N/A'}</p>
                        `;
                    }
                } catch (error) {
                    loader.style.display = 'none';
                    tokenInfoDiv.innerHTML = `<p><strong>Network or client-side error:</strong> ${error.message}</p>`;
                    console.error('Error fetching token:', error);
                }
            });
        });
    </script>
</body>
</html>
